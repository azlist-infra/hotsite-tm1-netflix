# ğŸ” Sistema de PermissÃµes - Guia Completo

DocumentaÃ§Ã£o completa do sistema centralizado de verificaÃ§Ã£o de permissÃµes para controle de acesso Ã s pÃ¡ginas.

---

## ğŸ“¦ ImportaÃ§Ã£o

```typescript
// Para Server Components
import { checkPermission } from '@/lib/auth'

// Para Client Components  
import { usePermission } from '@/lib/auth'
```

---

## ğŸ¯ Como Funciona

### **Regra de Redirecionamento:**
- âŒ **Sem permissÃ£o** â†’ Redireciona para `/app`
- âŒ **NÃ£o autenticado** â†’ Redireciona para `/auth/login`
- âœ… **Com permissÃ£o** â†’ Continua na pÃ¡gina

### **Tipos de ConfiguraÃ§Ã£o:**
- âœ… `requireAdmin` - Apenas administradores
- âœ… `roles` - Lista de roles permitidas
- âœ… `customCheck` - VerificaÃ§Ã£o customizada
- âœ… **SEM CONFIG** - Todos autenticados podem acessar

---

## ğŸ”§ Server Components (SSR)

Use `checkPermission` em **Server Components** (pÃ¡ginas sem `'use client'`).

### **Exemplo 1: Apenas Admin**

```typescript
// src/app/app/admin/clients/page.tsx
export default async function ClientsPage() {
    // âœ… 1 linha apenas! Se nÃ£o for admin, redireciona para /app
    await checkPermission({ requireAdmin: true })
    
    // Se chegou aqui, usuÃ¡rio Ã© admin
    const clients = await getClientsAction()
    return <ClientsTable clients={clients} />
}
```

### **Exemplo 2: Admin ou Gestor (Roles)**

```typescript
// src/app/app/users/page.tsx
export default async function UsersPage() {
    // âœ… Permite admin OU gestor
    await checkPermission({ 
        roles: ['admin', 'gestor'] 
    })
    
    // Se chegou aqui, usuÃ¡rio Ã© admin OU gestor
    const users = await getUsersAction()
    return <UsersTable users={users} />
}
```

### **Exemplo 3: Com Custom Check**

```typescript
// src/app/app/projects/[id]/page.tsx
export default async function ProjectPage({ params }: PageProps) {
    const { id } = await params
    
    // âœ… Retorna user para usar depois
    const { user } = await checkPermission({
        customCheck: (u) => u.isAdmin || u.projectId === id
    }, { id })
    
    // Se chegou aqui, usuÃ¡rio tem permissÃ£o
    return <ProjectDetails projectId={id} userId={user.id} />
}
```

### **Exemplo 4: Sem RestriÃ§Ã£o (Apenas Autenticado)**

```typescript
// src/app/app/profile/page.tsx
export default async function ProfilePage() {
    // âœ… Sem config = qualquer autenticado pode
    const { user } = await checkPermission()
    
    // Qualquer usuÃ¡rio autenticado pode acessar
    return <ProfileCard user={user} />
}
```

### **Exemplo 5: Custom Check AssÃ­ncrono**

```typescript
// VerificaÃ§Ã£o que precisa buscar dados
export default async function UserDetailPage({ params }: PageProps) {
    const { id } = await params
    
    const { user } = await checkPermission({
        customCheck: async (currentUser, params) => {
            // Admin sempre pode
            if (currentUser.isAdmin) return true
            
            // Gestor pode ver usuÃ¡rios do mesmo cliente
            if (currentUser.role === 'gestor') {
                const targetUser = await getUserByIdAction(params!.id)
                return targetUser.data?.clientId === currentUser.clientId
            }
            
            // UsuÃ¡rio pode ver prÃ³prio perfil
            return currentUser.id === params!.id
        }
    }, { id })
    
    return <UserDetails userId={id} />
}
```

---

## ğŸª Client Components (CSR)

Use `usePermission` em **Client Components** (pÃ¡ginas com `'use client'`).

### **Exemplo 1: Apenas Admin**

```typescript
'use client'
// src/app/app/admin/clients/new/page.tsx
export default function NewClientPage() {
    // âœ… Hook retorna user e estado de loading
    const { user, loading } = usePermission({ requireAdmin: true })
    
    // âœ… Mostra loading durante verificaÃ§Ã£o
    if (loading || !user) {
        return <LoadingPage text="Verificando permissÃµes..." />
    }
    
    // Se chegou aqui, usuÃ¡rio Ã© admin
    return (
        <FormPageLayout title="Criar Cliente">
            <ClientCreateForm />
        </FormPageLayout>
    )
}
```

### **Exemplo 2: Admin ou Gestor**

```typescript
'use client'
export default function UsersPage() {
    const { user, loading } = usePermission({ 
        roles: ['admin', 'gestor'] 
    })
    
    if (loading || !user) {
        return <LoadingPage />
    }
    
    return <UsersTable currentUser={user} />
}
```

### **Exemplo 3: Custom Check com Params**

```typescript
'use client'
export default function UserDetailPage({ params }: PageProps) {
    const [userId, setUserId] = useState('')
    
    // Resolve params
    useEffect(() => {
        params.then(p => setUserId(p.id))
    }, [params])
    
    // Verifica permissÃ£o com params
    const { user, loading } = usePermission({
        customCheck: (u) => u.isAdmin || u.id === userId
    }, { userId })
    
    if (loading || !user || !userId) {
        return <LoadingPage />
    }
    
    return <UserDetails userId={userId} />
}
```

### **Exemplo 4: Sem RestriÃ§Ã£o**

```typescript
'use client'
export default function DashboardPage() {
    // Sem config = todos autenticados podem
    const { user, loading } = usePermission()
    
    if (loading || !user) {
        return <LoadingPage />
    }
    
    return <Dashboard user={user} />
}
```

---

## ğŸ“Š ComparaÃ§Ã£o: Antes vs Depois

### **Antes** âŒ (40 linhas de cÃ³digo)

```typescript
'use client'
export default function NewClientPage() {
    const router = useRouter()
    const [isLoading, setIsLoading] = useState(true)
    const [hasPermission, setHasPermission] = useState(false)

    useEffect(() => {
        async function checkPermission() {
            const currentUser = await getCurrentUser()

            if (!currentUser) {
                router.push('/auth/login')
                return
            }

            // Apenas admins podem criar clientes
            if (!currentUser.isAdmin) {
                setHasPermission(false)
                setIsLoading(false)
                return
            }

            setHasPermission(true)
            setIsLoading(false)
        }

        checkPermission()
    }, [router])

    if (isLoading) {
        return <LoadingPage text="Verificando permissÃµes..." />
    }

    if (!hasPermission) {
        return (
            <Container maxW="container.md" py={8}>
                <ErrorBox title="Acesso Negado">
                    Apenas administradores podem criar clientes.
                </ErrorBox>
            </Container>
        )
    }
    
    return <FormPageLayout>...</FormPageLayout>
}
```

### **Depois** âœ… (4 linhas de cÃ³digo)

```typescript
'use client'
export default function NewClientPage() {
    const { user, loading } = usePermission({ requireAdmin: true })
    
    if (loading || !user) return <LoadingPage text="Verificando permissÃµes..." />
    
    return <FormPageLayout>...</FormPageLayout>
}
```

**Economia:** **90% menos cÃ³digo!** ğŸ‰

---

## ğŸ”‘ Tipos de PermissÃ£o

### **1. requireAdmin**

Permite apenas usuÃ¡rios com `isAdmin === true`.

```typescript
await checkPermission({ requireAdmin: true })
```

**Quando usar:**
- Criar/editar/deletar clientes
- Criar/editar usuÃ¡rios
- ConfiguraÃ§Ãµes do sistema
- RelatÃ³rios administrativos

---

### **2. roles**

Permite apenas usuÃ¡rios com roles especÃ­ficas.

```typescript
await checkPermission({ 
    roles: ['admin', 'gestor'] 
})
```

**Roles disponÃ­veis:**
- `'admin'` - Administrador do sistema
- `'gestor'` - Gestor de empresa
- `'operador'` - Operador
- `'assistente'` - Assistente

**Quando usar:**
- Listar usuÃ¡rios (admin ou gestor)
- Ver relatÃ³rios (admin ou gestor)
- Aprovar aÃ§Ãµes (admin ou gestor)

---

### **3. customCheck**

VerificaÃ§Ã£o personalizada com lÃ³gica customizada.

```typescript
await checkPermission({
    customCheck: (user, params) => {
        return user.isAdmin || user.id === params.id
    }
}, { id })
```

**Quando usar:**
- LÃ³gica complexa de permissÃ£o
- VerificaÃ§Ãµes que dependem de dados externos
- CombinaÃ§Ã£o de mÃºltiplas condiÃ§Ãµes
- PermissÃµes baseadas em relacionamentos (cliente, projeto, etc)

**Exemplos de custom checks:**

```typescript
// Ver prÃ³prio perfil OU ser admin
customCheck: (u) => u.isAdmin || u.id === userId

// Gestor do mesmo cliente OU admin
customCheck: (u) => u.isAdmin || (u.role === 'gestor' && u.clientId === clientId)

// ProprietÃ¡rio do recurso OU admin
customCheck: (u, params) => u.isAdmin || resource.ownerId === u.id

// MÃºltiplas condiÃ§Ãµes
customCheck: (u) => {
    if (u.isAdmin) return true
    if (u.role === 'gestor' && u.clientId === targetClientId) return true
    if (u.id === targetUserId) return true
    return false
}
```

---

### **4. Sem Config (PadrÃ£o)**

Permite qualquer usuÃ¡rio autenticado.

```typescript
await checkPermission()
// ou
const { user } = usePermission()
```

**Quando usar:**
- Dashboard
- Perfil do usuÃ¡rio
- PÃ¡ginas de informaÃ§Ã£o geral
- ConfiguraÃ§Ãµes pessoais

---

## ğŸ¯ Casos de Uso Reais do Projeto

### **Caso 1: MÃ³dulo Clients**

```typescript
// Listar clientes - APENAS ADMIN
// src/app/app/admin/clients/page.tsx
await checkPermission({ requireAdmin: true })

// Criar cliente - APENAS ADMIN
// src/app/app/admin/clients/new/page.tsx
const { user, loading } = usePermission({ requireAdmin: true })

// Ver cliente - APENAS ADMIN
// src/app/app/admin/clients/[id]/page.tsx
const { user, loading } = usePermission({ requireAdmin: true })

// Editar cliente - APENAS ADMIN
// src/app/app/admin/clients/[id]/edit/page.tsx
const { user, loading } = usePermission({ requireAdmin: true })
```

---

### **Caso 2: MÃ³dulo Users**

```typescript
// Listar usuÃ¡rios - ADMIN OU GESTOR
// src/app/app/users/page.tsx
await checkPermission({ roles: ['admin', 'gestor'] })

// Criar usuÃ¡rio - APENAS ADMIN
// src/app/app/users/new/page.tsx
const { user, loading } = usePermission({ requireAdmin: true })

// Ver usuÃ¡rio - ADMIN OU GESTOR OU PRÃ“PRIO PERFIL
// src/app/app/users/[id]/page.tsx
const { id } = await params
const { user } = await checkPermission({
    customCheck: async (currentUser, params) => {
        // Admin pode ver todos
        if (currentUser.isAdmin) return true
        
        // UsuÃ¡rio pode ver prÃ³prio perfil
        if (currentUser.id === params!.id) return true
        
        // Gestor pode ver usuÃ¡rios do mesmo cliente
        if (currentUser.role === 'gestor') {
            const targetUser = await getUserByIdAction(params!.id)
            return targetUser.data?.clientId === currentUser.clientId
        }
        
        return false
    }
}, { id })

// Editar usuÃ¡rio - ADMIN OU PRÃ“PRIO PERFIL
// src/app/app/users/[id]/edit/page.tsx
const { user } = usePermission({
    customCheck: (u) => u.isAdmin || u.id === userId
})

// Alterar privilÃ©gios - APENAS ADMIN
// src/app/app/users/[id]/privileges/page.tsx
await checkPermission({ requireAdmin: true })
```

---

### **Caso 3: MÃ³dulo Profile**

```typescript
// Ver prÃ³prio perfil - QUALQUER AUTENTICADO
// src/app/app/profile/page.tsx
const { user } = await checkPermission()

// Editar perfil - QUALQUER AUTENTICADO
// src/app/app/profile/edit/page.tsx
const { user } = usePermission()

// Alterar senha - QUALQUER AUTENTICADO
// src/app/app/profile/password/page.tsx
const { user } = usePermission()
```

---

## ğŸ“ API Reference

### **checkPermission (Server Action)**

```typescript
async function checkPermission(
    config?: PermissionConfig,
    params?: Record<string, string>
): Promise<{ user: User; hasPermission: true }>
```

**ParÃ¢metros:**

| ParÃ¢metro | Tipo | ObrigatÃ³rio | DescriÃ§Ã£o |
|-----------|------|-------------|-----------|
| `config` | `PermissionConfig` | âŒ | ConfiguraÃ§Ã£o de permissÃ£o |
| `config.requireAdmin` | `boolean` | âŒ | Se `true`, apenas admins |
| `config.roles` | `UserRole[]` | âŒ | Lista de roles permitidas |
| `config.customCheck` | `function` | âŒ | FunÃ§Ã£o de verificaÃ§Ã£o customizada |
| `params` | `Record<string, string>` | âŒ | Params da rota (para customCheck) |

**Retorno:**

| Campo | Tipo | DescriÃ§Ã£o |
|-------|------|-----------|
| `user` | `User` | UsuÃ¡rio autenticado |
| `hasPermission` | `true` | Sempre `true` (ou redireciona) |

**Comportamento:**
- Se nÃ£o autenticado: `redirect('/auth/login')`
- Se sem permissÃ£o: `redirect('/app')`
- Se com permissÃ£o: retorna `{ user, hasPermission: true }`

---

### **usePermission (Hook)**

```typescript
function usePermission(
    config?: PermissionConfig,
    params?: Record<string, string>
): { user: User | null; loading: boolean; hasPermission: boolean }
```

**ParÃ¢metros:**

| ParÃ¢metro | Tipo | ObrigatÃ³rio | DescriÃ§Ã£o |
|-----------|------|-------------|-----------|
| `config` | `PermissionConfig` | âŒ | ConfiguraÃ§Ã£o de permissÃ£o |
| `config.requireAdmin` | `boolean` | âŒ | Se `true`, apenas admins |
| `config.roles` | `UserRole[]` | âŒ | Lista de roles permitidas |
| `config.customCheck` | `function` | âŒ | FunÃ§Ã£o de verificaÃ§Ã£o customizada |
| `params` | `Record<string, string>` | âŒ | Params da rota (para customCheck) |

**Retorno:**

| Campo | Tipo | DescriÃ§Ã£o |
|-------|------|-----------|
| `user` | `User \| null` | UsuÃ¡rio (null durante loading) |
| `loading` | `boolean` | Estado de loading |
| `hasPermission` | `boolean` | Se tem permissÃ£o |

**Comportamento:**
- Durante verificaÃ§Ã£o: `loading = true`, `user = null`
- Se nÃ£o autenticado: `router.push('/auth/login')`
- Se sem permissÃ£o: `router.push('/app')`
- Se com permissÃ£o: `loading = false`, `user = User`, `hasPermission = true`

---

## ğŸ¨ Exemplos AvanÃ§ados

### **Exemplo 1: Gestor vendo usuÃ¡rios do prÃ³prio cliente**

```typescript
export default async function UsersPage() {
    const { user } = await checkPermission({
        customCheck: async (currentUser) => {
            // Admin vÃª todos
            if (currentUser.isAdmin) return true
            
            // Gestor vÃª apenas do prÃ³prio cliente
            if (currentUser.role === 'gestor') {
                // A listagem serÃ¡ filtrada depois baseado no clientId
                return true
            }
            
            return false
        }
    })
    
    // Filtra usuÃ¡rios baseado no clientId se for gestor
    const users = user.isAdmin 
        ? await getUsersAction()
        : await getUsersByClientAction(user.clientId)
    
    return <UsersTable users={users} />
}
```

### **Exemplo 2: UsuÃ¡rio editando prÃ³prio perfil OU admin editando qualquer**

```typescript
export default async function UserEditPage({ params }: PageProps) {
    const { id } = await params
    
    const { user } = await checkPermission({
        customCheck: (currentUser) => {
            // Admin pode editar qualquer usuÃ¡rio
            if (currentUser.isAdmin) return true
            
            // UsuÃ¡rio sÃ³ pode editar prÃ³prio perfil
            return currentUser.id === id
        }
    }, { id })
    
    // Busca dados do usuÃ¡rio a ser editado
    const targetUser = await getUserByIdAction(id)
    
    return (
        <FormPageLayout>
            <UserEditForm 
                user={targetUser.data} 
                isEditingSelf={user.id === id}
                currentUser={user}
            />
        </FormPageLayout>
    )
}
```

### **Exemplo 3: PermissÃ£o baseada em feature flag**

```typescript
export default async function BetaFeaturePage() {
    const { user } = await checkPermission({
        customCheck: (u) => {
            // Admin sempre tem acesso
            if (u.isAdmin) return true
            
            // Ou usuÃ¡rios com beta flag ativado
            return u.features?.betaAccess === true
        }
    })
    
    return <BetaFeature />
}
```

### **Exemplo 4: HorÃ¡rio de acesso**

```typescript
export default async function RestrictedPage() {
    await checkPermission({
        customCheck: (user) => {
            // Admin sempre pode
            if (user.isAdmin) return true
            
            // Outros sÃ³ em horÃ¡rio comercial
            const hour = new Date().getHours()
            return hour >= 9 && hour < 18
        }
    })
    
    return <RestrictedContent />
}
```

---

## ğŸ”„ Fluxo de ExecuÃ§Ã£o

### **Server Component:**

```
1. PÃ¡gina Ã© requisitada
   â†“
2. checkPermission() executa no servidor
   â†“
3. Busca getCurrentUser()
   â†“
4. Verifica config (requireAdmin, roles, customCheck)
   â†“
5a. SEM PERMISSÃƒO â†’ redirect('/app')
5b. COM PERMISSÃƒO â†’ retorna { user }
   â†“
6. PÃ¡gina renderiza com user
```

### **Client Component:**

```
1. PÃ¡gina renderiza (loading=true)
   â†“
2. useEffect dispara usePermission()
   â†“
3. Busca getCurrentUser() via Server Action
   â†“
4. Verifica config (requireAdmin, roles, customCheck)
   â†“
5a. SEM PERMISSÃƒO â†’ router.push('/app')
5b. COM PERMISSÃƒO â†’ setState({ user, loading: false })
   â†“
6. PÃ¡gina re-renderiza com user
```

---

## âš™ï¸ ConfiguraÃ§Ã£o de PermissÃµes por MÃ³dulo

### **Clients (Apenas Admin)**
```typescript
// TODAS as rotas de clients requerem admin
await checkPermission({ requireAdmin: true })
```

### **Users (Admin ou Gestor para listar, Admin para criar)**
```typescript
// Listar: Admin ou Gestor
await checkPermission({ roles: ['admin', 'gestor'] })

// Criar: Apenas Admin
await checkPermission({ requireAdmin: true })

// Ver detalhes: Admin, Gestor (mesmo cliente) ou prÃ³prio perfil
await checkPermission({
    customCheck: (user, params) => {
        if (user.isAdmin) return true
        if (user.id === params.id) return true
        // ... lÃ³gica de gestor
        return false
    }
}, { id })
```

### **Profile (Qualquer Autenticado)**
```typescript
// Sem restriÃ§Ã£o - apenas autenticado
const { user } = await checkPermission()
```

---

## ğŸ¯ Boas PrÃ¡ticas

### âœ… **DO (Fazer)**

```typescript
// âœ… Use checkPermission em Server Components
export default async function Page() {
    await checkPermission({ requireAdmin: true })
}

// âœ… Use usePermission em Client Components
export default function Page() {
    const { user, loading } = usePermission({ requireAdmin: true })
}

// âœ… Sempre verifique loading no Client
if (loading || !user) return <LoadingPage />

// âœ… Retorne user para evitar buscar novamente
const { user } = await checkPermission()
return <Component userId={user.id} />

// âœ… Use customCheck para lÃ³gica complexa
customCheck: (user) => user.isAdmin || user.role === 'gestor'
```

### âŒ **DON'T (NÃ£o Fazer)**

```typescript
// âŒ NÃ£o use checkPermission em Client Component
'use client'
await checkPermission()  // ERRO!

// âŒ NÃ£o use usePermission em Server Component
export default async function Page() {
    const { user } = usePermission()  // ERRO!
}

// âŒ NÃ£o ignore o loading
const { user } = usePermission()
return <Component user={user} />  // user pode ser null!

// âŒ NÃ£o faÃ§a verificaÃ§Ã£o manual
if (!user.isAdmin) redirect('/app')  // Use checkPermission!

// âŒ NÃ£o busque user novamente
await checkPermission()
const user = await getCurrentUser()  // Redundante!
```

---

## ğŸš€ Checklist de ImplementaÃ§Ã£o

Ao criar uma nova pÃ¡gina protegida:

- [ ] Identifique se Ã© Server ou Client Component
- [ ] Escolha o tipo de permissÃ£o (admin, roles, custom, ou nenhuma)
- [ ] Adicione `checkPermission` (Server) ou `usePermission` (Client)
- [ ] Verifique `loading` no Client Component
- [ ] Use `user` retornado (evite buscar novamente)
- [ ] Teste navegaÃ§Ã£o (com e sem permissÃ£o)

---

## ğŸ” Debug e Troubleshooting

### **Problema: Redirect infinito**

```typescript
// âŒ Causa loop
customCheck: (user) => {
    router.push('/app')  // NÃ£o faÃ§a isso!
    return false
}

// âœ… SoluÃ§Ã£o
customCheck: (user) => {
    return false  // Apenas retorne false, o sistema redireciona
}
```

### **Problema: Loading infinito**

```typescript
// âŒ Hook sem dependÃªncias corretas
useEffect(() => {
    check()
}, [])  // Faltou config e params!

// âœ… JÃ¡ estÃ¡ correto no usePermission
useEffect(() => {
    check()
}, [config, params, router])
```

### **Problema: User null mesmo com permissÃ£o**

```typescript
// âŒ NÃ£o verifica loading
const { user } = usePermission()
return <Component user={user.id} />  // Erro: user Ã© null!

// âœ… Sempre verifique loading
const { user, loading } = usePermission()
if (loading || !user) return <LoadingPage />
return <Component user={user.id} />
```

---

## ğŸ“ˆ EstatÃ­sticas de ReduÃ§Ã£o de CÃ³digo

### **MÃ³dulo Clients:**

| PÃ¡gina | Antes | Depois | Economia |
|--------|-------|--------|----------|
| `page.tsx` | 28 linhas | 1 linha | **96%** â¬‡ï¸ |
| `new/page.tsx` | 40 linhas | 4 linhas | **90%** â¬‡ï¸ |
| `[id]/page.tsx` | 47 linhas | 3 linhas | **94%** â¬‡ï¸ |
| `[id]/edit/page.tsx` | 34 linhas | 3 linhas | **91%** â¬‡ï¸ |
| **TOTAL** | **149 linhas** | **11 linhas** | **93%** â¬‡ï¸ |

---

## ğŸ“ Exemplo Completo - Do Zero

```typescript
// ========================================
// PÃGINA: /app/events/[id]/participants/page.tsx
// PERMISSÃƒO: Admin OU organizador do evento
// ========================================

'use client'

import { useEffect, useState } from 'react'
import { usePermission } from '@/lib/auth'
import { getEventByIdAction } from '@/app/api/events'
import { LoadingPage } from '@/components/ui'

interface PageProps {
    params: Promise<{ id: string }>
}

export default function EventParticipantsPage({ params }: PageProps) {
    // 1. Resolve params
    const [eventId, setEventId] = useState('')
    
    useEffect(() => {
        params.then(p => setEventId(p.id))
    }, [params])
    
    // 2. Verifica permissÃ£o (admin OU organizador do evento)
    const { user, loading } = usePermission({
        customCheck: async (currentUser, params) => {
            // Admin pode ver todos os eventos
            if (currentUser.isAdmin) return true
            
            // Busca evento para verificar se Ã© organizador
            if (params?.id) {
                const event = await getEventByIdAction(params.id)
                return event.data?.organizerId === currentUser.id
            }
            
            return false
        }
    }, { id: eventId })
    
    // 3. Loading state
    if (loading || !user || !eventId) {
        return <LoadingPage text="Verificando permissÃµes..." />
    }
    
    // 4. Renderiza (tem permissÃ£o!)
    return (
        <div>
            <h1>Participantes do Evento</h1>
            <ParticipantsList eventId={eventId} />
        </div>
    )
}
```

---

## ğŸ”— Arquivos Relacionados

- **ImplementaÃ§Ã£o:** `src/lib/auth/check-permission.ts`
- **Hook:** `src/lib/auth/use-permission.ts`
- **Tipos:** `src/app/api/auth/auth.types.ts`
- **Server Action:** `src/app/api/auth/auth.action.ts`

---

## ğŸ’¡ Dicas Pro

### **1. Combine permissÃµes**

```typescript
await checkPermission({
    requireAdmin: true,  // â† Primeiro verifica se Ã© admin
    roles: ['admin'],    // â† Se passar, verifica role
    customCheck: (u) => u.isActive  // â† Se passar, faz check custom
})
// Todas as condiÃ§Ãµes sÃ£o verificadas em ordem!
```

### **2. Reutilize checks**

```typescript
// src/lib/auth/common-checks.ts
export const isOwnerOrAdmin = (ownerId: string) => ({
    customCheck: (user: User) => user.isAdmin || user.id === ownerId
})

// Uso
await checkPermission(isOwnerOrAdmin(resource.ownerId))
```

### **3. Logging para debug**

```typescript
await checkPermission({
    customCheck: (user) => {
        const hasPermission = user.isAdmin || user.role === 'gestor'
        console.log('[Permission Check]', { 
            userId: user.id, 
            role: user.role, 
            hasPermission 
        })
        return hasPermission
    }
})
```

---

## ğŸ‰ ConclusÃ£o

**Sistema de permissÃµes:**
- âœ… Centralizado e consistente
- âœ… Simples de usar (1 linha por pÃ¡gina)
- âœ… FlexÃ­vel (admin, roles, custom)
- âœ… Type-safe
- âœ… Redirect automÃ¡tico
- âœ… Funciona em Server E Client
- âœ… 93% menos cÃ³digo

**Agora vocÃª tem controle total de permissÃµes de forma profissional!** ğŸš€

